# GitHub CI/CD æ“ä½œæµç¨‹è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†è§£é‡ŠGitHub Actionsçš„CI/CDå·¥ä½œæµç¨‹ï¼Œå¸®åŠ©ä½ ç†è§£æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ã€‚

## ğŸ“‹ ç›®å½•

1. [CI/CDåŸºæœ¬æ¦‚å¿µ](#cicdåŸºæœ¬æ¦‚å¿µ)
2. [GitHub Actionsç®€ä»‹](#github-actionsç®€ä»‹)
3. [å·¥ä½œæµé…ç½®è¯¦è§£](#å·¥ä½œæµé…ç½®è¯¦è§£)
4. [å®é™…æ“ä½œæ­¥éª¤](#å®é™…æ“ä½œæ­¥éª¤)
5. [æŸ¥çœ‹è¿è¡Œç»“æœ](#æŸ¥çœ‹è¿è¡Œç»“æœ)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## CI/CDåŸºæœ¬æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯CI (æŒç»­é›†æˆ)?

**æŒç»­é›†æˆ (Continuous Integration)** æ˜¯æŒ‡å¼€å‘äººå‘˜é¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°ä¸»åˆ†æ”¯çš„å®è·µã€‚æ¯æ¬¡é›†æˆéƒ½ä¼šé€šè¿‡è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•æ¥éªŒè¯ï¼Œä»è€Œå°½æ—©å‘ç°é›†æˆé”™è¯¯ã€‚

**ä¸»è¦å¥½å¤„:**
- âœ… å¿«é€Ÿå‘ç°å’Œå®šä½é”™è¯¯
- âœ… å‡å°‘é›†æˆé—®é¢˜
- âœ… æé«˜ä»£ç è´¨é‡
- âœ… åŠ å¿«å¼€å‘é€Ÿåº¦

### ä»€ä¹ˆæ˜¯CD (æŒç»­äº¤ä»˜/æŒç»­éƒ¨ç½²)?

**æŒç»­äº¤ä»˜ (Continuous Delivery)** æ˜¯åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåçš„ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒã€‚

**æŒç»­éƒ¨ç½² (Continuous Deployment)** æ›´è¿›ä¸€æ­¥ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–åœ°å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

---

## GitHub Actionsç®€ä»‹

GitHub Actionsæ˜¯GitHubæä¾›çš„CI/CDå¹³å°ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–ä½ çš„è½¯ä»¶å¼€å‘å·¥ä½œæµç¨‹ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

1. **Workflow (å·¥ä½œæµ)**: è‡ªåŠ¨åŒ–æµç¨‹ï¼Œå®šä¹‰åœ¨`.github/workflows/`ç›®å½•ä¸‹çš„YAMLæ–‡ä»¶ä¸­
2. **Job (ä»»åŠ¡)**: å·¥ä½œæµä¸­çš„ä¸€ç»„æ­¥éª¤ï¼Œåœ¨åŒä¸€ä¸ªè¿è¡Œå™¨ä¸Šæ‰§è¡Œ
3. **Step (æ­¥éª¤)**: ä»»åŠ¡ä¸­çš„å•ä¸ªæ“ä½œ
4. **Action (åŠ¨ä½œ)**: å¯é‡ç”¨çš„æ­¥éª¤å•å…ƒ
5. **Runner (è¿è¡Œå™¨)**: æ‰§è¡Œå·¥ä½œæµçš„æœåŠ¡å™¨

### å·¥ä½œæµæ‰§è¡Œæµç¨‹

```
è§¦å‘äº‹ä»¶ â†’ å·¥ä½œæµå¯åŠ¨ â†’ å¹¶è¡Œ/ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ â†’ æ¯ä¸ªä»»åŠ¡æ‰§è¡Œå¤šä¸ªæ­¥éª¤ â†’ ç”Ÿæˆç»“æœ
```

---

## å·¥ä½œæµé…ç½®è¯¦è§£

è®©æˆ‘ä»¬é€æ­¥è§£æ`.github/workflows/ci.yml`æ–‡ä»¶ï¼š

### 1. å·¥ä½œæµåç§°å’Œè§¦å‘æ¡ä»¶

```yaml
name: C++ CI/CD Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
```

**è¯´æ˜:**
- `name`: å·¥ä½œæµçš„åç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨GitHubç•Œé¢ä¸Š
- `on`: å®šä¹‰è§¦å‘æ¡ä»¶
  - `push`: å½“ä»£ç æ¨é€åˆ°mainæˆ–masteråˆ†æ”¯æ—¶è§¦å‘
  - `pull_request`: å½“åˆ›å»ºPRåˆ°mainæˆ–masteråˆ†æ”¯æ—¶è§¦å‘
  - `workflow_dispatch`: å…è®¸åœ¨GitHubç•Œé¢æ‰‹åŠ¨è§¦å‘

### 2. ä»»åŠ¡å®šä¹‰å’ŒçŸ©é˜µç­–ç•¥

```yaml
jobs:
  build-and-test:
    name: Build and Test on ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        build_type: [Release]
```

**è¯´æ˜:**
- `jobs`: å®šä¹‰å·¥ä½œæµä¸­çš„æ‰€æœ‰ä»»åŠ¡
- `strategy.matrix`: çŸ©é˜µç­–ç•¥ï¼Œè‡ªåŠ¨åœ¨å¤šä¸ªé…ç½®ä¸Šè¿è¡Œ
  - è¿™é‡Œä¼šåœ¨3ä¸ªæ“ä½œç³»ç»Ÿä¸Šå„è¿è¡Œä¸€æ¬¡
  - `fail-fast: false`: ä¸€ä¸ªå¹³å°å¤±è´¥ä¸å½±å“å…¶ä»–å¹³å°
- `${{ matrix.os }}`: å¼•ç”¨çŸ©é˜µå˜é‡

### 3. è¿è¡Œç¯å¢ƒ

```yaml
runs-on: ${{ matrix.os }}
```

**è¯´æ˜:**
- æŒ‡å®šä»»åŠ¡è¿è¡Œçš„è™šæ‹Ÿæœºç¯å¢ƒ
- GitHubæä¾›çš„è¿è¡Œå™¨: `ubuntu-latest`, `macos-latest`, `windows-latest`

### 4. æ­¥éª¤è¯¦è§£

#### æ£€å‡ºä»£ç 
```yaml
- name: ğŸ“¥ Checkout code
  uses: actions/checkout@v4
```
- ä½¿ç”¨GitHubå®˜æ–¹Actionæ‹‰å–ä»£ç 
- è¿™æ˜¯å‡ ä¹æ‰€æœ‰å·¥ä½œæµçš„ç¬¬ä¸€æ­¥

#### æ¡ä»¶æ‰§è¡Œ
```yaml
- name: ğŸ§ Install dependencies (Ubuntu)
  if: runner.os == 'Linux'
  run: |
    sudo apt-get update
    sudo apt-get install -y build-essential
```
- `if`: æ¡ä»¶åˆ¤æ–­ï¼Œåªåœ¨Linuxä¸Šæ‰§è¡Œ
- `run`: æ‰§è¡Œshellå‘½ä»¤
- `|`: YAMLå¤šè¡Œå­—ç¬¦ä¸²è¯­æ³•

#### æ„å»ºå’Œæµ‹è¯•
```yaml
- name: ğŸ”¨ Build Project
  working-directory: ${{github.workspace}}/build
  run: cmake --build . --config ${{ matrix.build_type }}

- name: ğŸ§ª Run Tests
  working-directory: ${{github.workspace}}/build
  run: ctest -C ${{ matrix.build_type }} --output-on-failure
```
- `working-directory`: æŒ‡å®šå‘½ä»¤æ‰§è¡Œç›®å½•
- `${{github.workspace}}`: GitHubæä¾›çš„ä¸Šä¸‹æ–‡å˜é‡

#### ä¸Šä¼ æ„å»ºäº§ç‰©
```yaml
- name: ğŸ“¦ Upload Artifacts
  uses: actions/upload-artifact@v4
  with:
    name: calculator-${{ matrix.os }}-${{ matrix.build_type }}
    path: |
      build/calculator_app*
      build/calculator_tests*
    retention-days: 7
```
- ä¿å­˜æ„å»ºç»“æœï¼Œå¯ä»¥åœ¨GitHubç•Œé¢ä¸‹è½½
- `retention-days`: ä¿ç•™å¤©æ•°

### 5. ä»»åŠ¡ä¾èµ–

```yaml
summary:
  name: CI Summary
  needs: [build-and-test, code-quality]
  if: always()
```

**è¯´æ˜:**
- `needs`: æŒ‡å®šä¾èµ–å…³ç³»ï¼Œåªæœ‰å‰é¢çš„ä»»åŠ¡å®Œæˆåæ‰æ‰§è¡Œ
- `if: always()`: æ— è®ºå‰é¢ä»»åŠ¡æˆåŠŸä¸å¦éƒ½æ‰§è¡Œ

---

## å®é™…æ“ä½œæ­¥éª¤

### æ­¥éª¤1: åˆå§‹åŒ–Gitä»“åº“ï¼ˆå·²å®Œæˆ âœ…ï¼‰

```bash
cd c:\Users\tyk\Desktop\test
git init
git add .
git commit -m "Initial commit: C++ CI/CD project"
```

### æ­¥éª¤2: åœ¨GitHubä¸Šåˆ›å»ºä»“åº“ï¼ˆå·²å®Œæˆ âœ…ï¼‰

ä»“åº“åœ°å€ï¼šhttps://github.com/tyk-lab/test-github-cicd

### æ­¥éª¤3: æ¨é€åˆ°GitHubï¼ˆå·²å®Œæˆ âœ…ï¼‰

```bash
git remote add origin git@github.com:tyk-lab/test-github-cicd.git
git branch -M main
git push -u origin main
```

### æ­¥éª¤4: GitHubè‡ªåŠ¨è¿è¡ŒCI/CDï¼ˆå·²è¿è¡Œ âœ…ï¼‰

æ¨é€ä»£ç åï¼ŒGitHubä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹ `.github/workflows/ci.yml` æ–‡ä»¶
2. è§¦å‘å·¥ä½œæµ
3. åœ¨3ä¸ªå¹³å°ä¸Šå¹¶è¡Œæ„å»ºå’Œæµ‹è¯•
4. è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
5. åˆ›å»ºGitHub Releaseå¹¶ä¸Šä¼ ç¼–è¯‘äº§ç‰©

### æ­¥éª¤5: æŸ¥çœ‹è¿è¡Œç»“æœ

è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š
- **Actionsé¡µé¢**: https://github.com/tyk-lab/test-github-cicd/actions
- **Releasesé¡µé¢**: https://github.com/tyk-lab/test-github-cicd/releases
- **ä»“åº“ä¸»é¡µ**: https://github.com/tyk-lab/test-github-cicd (æŸ¥çœ‹å¾½ç« )

---

## æŸ¥çœ‹è¿è¡Œç»“æœ

### åœ¨GitHubç•Œé¢æŸ¥çœ‹

1. æ‰“å¼€ä½ çš„GitHubä»“åº“
2. ç‚¹å‡»é¡¶éƒ¨çš„ **"Actions"** æ ‡ç­¾
3. ä½ ä¼šçœ‹åˆ°:
   - å·¥ä½œæµè¿è¡Œåˆ—è¡¨
   - æ¯æ¬¡è¿è¡Œçš„çŠ¶æ€ (âœ…æˆåŠŸ / âŒå¤±è´¥ / ğŸŸ¡è¿›è¡Œä¸­)
   - ç‚¹å‡»æŸæ¬¡è¿è¡Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…

åœ¨Actionsé¡µé¢ç‚¹å‡»æŸæ¬¡è¿è¡Œå:
- å·¦ä¾§æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡
- ç‚¹å‡»ä»»åŠ¡å¯ä»¥å±•å¼€æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤
- ç‚¹å‡»æ­¥éª¤å¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- å¯ä»¥ä¸‹è½½æ„å»ºäº§ç‰© (Artifacts)

### ç†è§£è¿è¡ŒçŠ¶æ€

- âœ… **ç»¿è‰²å¯¹å‹¾**: æ‰€æœ‰æ­¥éª¤æˆåŠŸ
- âŒ **çº¢è‰²å‰å·**: æœ‰æ­¥éª¤å¤±è´¥
- ğŸŸ¡ **é»„è‰²åœ†ç‚¹**: æ­£åœ¨è¿è¡Œ
- âšª **ç°è‰²åœ†åœˆ**: ç­‰å¾…ä¸­æˆ–å·²è·³è¿‡

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ?

åœ¨Actionsé¡µé¢:
1. é€‰æ‹©ä½ çš„å·¥ä½œæµ
2. ç‚¹å‡»å³ä¾§"Run workflow"æŒ‰é’®
3. é€‰æ‹©åˆ†æ”¯ï¼Œç‚¹å‡»"Run workflow"

### Q2: æ„å»ºå¤±è´¥æ€ä¹ˆåŠ?

1. ç‚¹å‡»å¤±è´¥çš„è¿è¡Œ
2. æŸ¥çœ‹å¤±è´¥æ­¥éª¤çš„æ—¥å¿—
3. æ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®å¤ä»£ç 
4. æäº¤ä¿®å¤å¹¶æ¨é€ï¼Œè‡ªåŠ¨è§¦å‘æ–°çš„è¿è¡Œ

### Q3: å¦‚ä½•åªåœ¨æŸäº›æ–‡ä»¶æ”¹å˜æ—¶è§¦å‘?

ä¿®æ”¹`on`éƒ¨åˆ†:
```yaml
on:
  push:
    branches: [ main ]
    paths:
      - 'src/**'
      - 'tests/**'
```

### Q4: å¦‚ä½•æ·»åŠ ç¯å¢ƒå˜é‡?

åœ¨ä»»åŠ¡æˆ–æ­¥éª¤ä¸­æ·»åŠ `env`:
```yaml
env:
  MY_VAR: value
steps:
  - name: Use env
    run: echo $MY_VAR
```

### Q5: å¦‚ä½•ä½¿ç”¨secrets?

1. åœ¨GitHubä»“åº“è®¾ç½®ä¸­æ·»åŠ Secrets
2. åœ¨å·¥ä½œæµä¸­å¼•ç”¨: `${{ secrets.MY_SECRET }}`

---

## è¿›é˜¶å­¦ä¹ å»ºè®®

1. **æ·»åŠ ä»£ç è¦†ç›–ç‡**: é›†æˆgcov/lcovç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
2. **é™æ€åˆ†æ**: æ·»åŠ cppcheckæˆ–clang-tidy
3. **æ€§èƒ½æµ‹è¯•**: æ·»åŠ åŸºå‡†æµ‹è¯•æ­¥éª¤
4. **è‡ªåŠ¨å‘å¸ƒ**: ä½¿ç”¨GitHub Releasesè‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬ï¼ˆâœ… å·²å®ç°ï¼‰
5. **ç¼“å­˜ä¾èµ–**: ä½¿ç”¨ `actions/cache` åŠ é€Ÿæ„å»º
6. **é€šçŸ¥é›†æˆ**: å¤±è´¥æ—¶å‘é€é‚®ä»¶æˆ–Slacké€šçŸ¥
7. **Dockeræ”¯æŒ**: æ·»åŠ å®¹å™¨åŒ–æ„å»ºå’Œéƒ¨ç½²
8. **æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨ç”ŸæˆDoxygenæ–‡æ¡£å¹¶å‘å¸ƒåˆ°GitHub Pages

## ğŸ¯ æœ¬é¡¹ç›®å·²å®ç°çš„åŠŸèƒ½

- âœ… å¤šå¹³å°æ„å»ºï¼ˆLinuxã€macOSã€Windowsï¼‰
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•
- âœ… ä»£ç è´¨é‡æ£€æŸ¥
- âœ… çŠ¶æ€å¾½ç« 
- âœ… è‡ªåŠ¨åˆ›å»ºRelease
- âœ… æ„å»ºäº§ç‰©ä¸Šä¼ å’Œåˆ†å‘
- âœ… è¯¦ç»†çš„æ‰§è¡Œæ‘˜è¦

---

## æ€»ç»“

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å­¦åˆ°äº†:

âœ… CI/CDçš„åŸºæœ¬æ¦‚å¿µå’Œé‡è¦æ€§  
âœ… GitHub Actionsçš„å·¥ä½œåŸç†  
âœ… å¦‚ä½•ç¼–å†™å·¥ä½œæµé…ç½®æ–‡ä»¶  
âœ… å¤šå¹³å°æ„å»ºå’Œæµ‹è¯•  
âœ… æ„å»ºäº§ç‰©ç®¡ç†  
âœ… å¦‚ä½•æŸ¥çœ‹å’Œè°ƒè¯•CI/CDè¿è¡Œç»“æœ  

**ä¸‹ä¸€æ­¥**: å°è¯•ä¿®æ”¹ä»£ç ï¼Œè§‚å¯ŸCI/CDå¦‚ä½•è‡ªåŠ¨è¿è¡Œå¹¶éªŒè¯ä½ çš„æ›´æ”¹ï¼

---

## å‚è€ƒèµ„æº

- [GitHub Actionså®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [GitHub Actionså¸‚åœº](https://github.com/marketplace?type=actions)
- [YAMLè¯­æ³•](https://yaml.org/)
- [CMakeæ–‡æ¡£](https://cmake.org/documentation/)
